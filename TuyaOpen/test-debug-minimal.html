<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>🔍 Debug问题最小化测试</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f0f0f0; }
        .log { background: #000; color: #0f0; padding: 15px; height: 300px; overflow-y: auto; font-family: monospace; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>🔍 Debug问题最小化测试</h1>
    
    <div>
        <button onclick="testStep1()">1. 只创建实例</button>
        <button onclick="testStep2()">2. 测试debugLog</button>
        <button onclick="testStep3()">3. 测试info</button>
        <button onclick="testStep4()">4. 测试error</button>
        <button onclick="testStep5()">5. 测试write</button>
        <button onclick="clearLog()">清空</button>
    </div>
    
    <div id="log" class="log">
准备开始分步测试...
    </div>

    <script src="downloaders/base-downloader.js"></script>
    <script src="downloaders/esp32/esp32-esptool-js-wrapper.js"></script>

    <script>
        function log(msg) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${msg}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        let downloader = null;

        function testStep1() {
            try {
                log('🔍 步骤1: 创建ESP32EsptoolJSWrapper实例...');
                downloader = new ESP32EsptoolJSWrapper(null, {
                    log: (msg) => log(`[CALLBACK] ${msg}`)
                });
                log('✅ 实例创建成功');
                log(`- debugLog方法: ${typeof downloader.debugLog}`);
                log(`- info方法: ${typeof downloader.info}`);
                log(`- error方法: ${typeof downloader.error}`);
                log(`- write方法: ${typeof downloader.write}`);
                log(`- debug属性: ${typeof downloader.debug}`);
                log(`- baseDebugFunction: ${typeof downloader.baseDebugFunction}`);
            } catch (error) {
                log(`❌ 步骤1失败: ${error.message}`);
                console.error('步骤1详细错误:', error);
            }
        }

        function testStep2() {
            if (!downloader) {
                log('❌ 请先执行步骤1创建实例');
                return;
            }
            
            try {
                log('🔍 步骤2: 测试debugLog方法...');
                downloader.debugLog('这是debugLog测试消息');
                log('✅ debugLog调用成功');
            } catch (error) {
                log(`❌ 步骤2失败: ${error.message}`);
                console.error('步骤2详细错误:', error);
                console.error('错误堆栈:', error.stack);
            }
        }

        function testStep3() {
            if (!downloader) {
                log('❌ 请先执行步骤1创建实例');
                return;
            }
            
            try {
                log('🔍 步骤3: 测试info方法...');
                downloader.info('这是info测试消息');
                log('✅ info调用成功');
            } catch (error) {
                log(`❌ 步骤3失败: ${error.message}`);
                console.error('步骤3详细错误:', error);
                console.error('错误堆栈:', error.stack);
            }
        }

        function testStep4() {
            if (!downloader) {
                log('❌ 请先执行步骤1创建实例');
                return;
            }
            
            try {
                log('🔍 步骤4: 测试error方法...');
                downloader.error('这是error测试消息');
                log('✅ error调用成功');
            } catch (error) {
                log(`❌ 步骤4失败: ${error.message}`);
                console.error('步骤4详细错误:', error);
                console.error('错误堆栈:', error.stack);
            }
        }

        function testStep5() {
            if (!downloader) {
                log('❌ 请先执行步骤1创建实例');
                return;
            }
            
            try {
                log('🔍 步骤5: 测试write方法...');
                downloader.write('这是write测试消息');
                log('✅ write调用成功');
            } catch (error) {
                log(`❌ 步骤5失败: ${error.message}`);
                console.error('步骤5详细错误:', error);
                console.error('错误堆栈:', error.stack);
            }
        }
    </script>
</body>
</html> 
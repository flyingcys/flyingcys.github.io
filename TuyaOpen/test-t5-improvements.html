<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T5ä¸‹è½½å™¨æ”¹è¿›åŠŸèƒ½éªŒè¯</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .stats-table th, .stats-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        .stats-table th {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        .flash-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            background-color: white;
        }
        .flash-item {
            padding: 5px;
            border-bottom: 1px solid #eee;
            font-family: monospace;
            font-size: 12px;
        }
        pre {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ T5ä¸‹è½½å™¨æ”¹è¿›åŠŸèƒ½éªŒè¯</h1>
        <div class="info test-result">
            <strong>éªŒè¯ç›®æ ‡ï¼š</strong>ç¡®ä¿JSç‰ˆæœ¬T5ä¸‹è½½å™¨ä¸Pythonç‰ˆæœ¬åŠŸèƒ½å®Œå…¨ä¸€è‡´
        </div>

        <!-- æ¨¡å—åŠ è½½éªŒè¯ -->
        <div class="test-section">
            <h2>ğŸ“¦ 1. æ¨¡å—åŠ è½½éªŒè¯</h2>
            <p>éªŒè¯æ‰€æœ‰æ ¸å¿ƒæ¨¡å—æ˜¯å¦æ­£ç¡®åŠ è½½å’Œåˆå§‹åŒ–</p>
            <button onclick="testModuleLoading()">å¼€å§‹æµ‹è¯•</button>
            <div id="moduleLoadingResult"></div>
        </div>

        <!-- Flashé…ç½®éªŒè¯ -->
        <div class="test-section">
            <h2>ğŸ’¾ 2. Flashé…ç½®å®Œæ•´æ€§éªŒè¯</h2>
            <p>éªŒè¯æ˜¯å¦æ”¯æŒ39ç§Flashå‹å·ï¼ˆä¸Pythonç‰ˆæœ¬ä¸€è‡´ï¼‰</p>
            <button onclick="testFlashConfig()">å¼€å§‹æµ‹è¯•</button>
            <div id="flashConfigResult"></div>
            <div id="flashList" class="flash-list" style="display:none;"></div>
        </div>

        <!-- åè®®ç³»ç»ŸéªŒè¯ -->
        <div class="test-section">
            <h2>ğŸ”— 3. åè®®ç³»ç»ŸéªŒè¯</h2>
            <p>éªŒè¯21ä¸ªT5åè®®ç±»æ˜¯å¦æ­£ç¡®å®ç°</p>
            <button onclick="testProtocols()">å¼€å§‹æµ‹è¯•</button>
            <div id="protocolResult"></div>
        </div>

        <!-- æ™ºèƒ½æ“¦é™¤ç­–ç•¥éªŒè¯ -->
        <div class="test-section">
            <h2>ğŸ§¹ 4. æ™ºèƒ½æ“¦é™¤ç­–ç•¥éªŒè¯</h2>
            <p>éªŒè¯64K/32K/4Kè‡ªé€‚åº”æ“¦é™¤ç®—æ³•</p>
            <button onclick="testEraseStrategy()">å¼€å§‹æµ‹è¯•</button>
            <div id="eraseStrategyResult"></div>
        </div>

        <!-- åœ°å€å¯¹é½å¤„ç†éªŒè¯ -->
        <div class="test-section">
            <h2>ğŸ“ 5. åœ°å€å¯¹é½å¤„ç†éªŒè¯</h2>
            <p>éªŒè¯ä»»æ„åœ°å€å†™å…¥çš„å¯¹é½å¤„ç†åŠŸèƒ½</p>
            <button onclick="testAddressAlignment()">å¼€å§‹æµ‹è¯•</button>
            <div id="addressAlignmentResult"></div>
        </div>

        <!-- ç»¼åˆåŠŸèƒ½éªŒè¯ -->
        <div class="test-section">
            <h2>ğŸ¯ 6. ç»¼åˆåŠŸèƒ½éªŒè¯</h2>
            <p>è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼Œç”Ÿæˆå®Œæ•´çš„éªŒè¯æŠ¥å‘Š</p>
            <button onclick="runAllTests()" id="runAllBtn">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <div id="comprehensiveResult"></div>
        </div>
    </div>

    <!-- åŠ è½½æ‰€æœ‰å¿…éœ€çš„æ¨¡å— -->
    <script src="downloaders/protocols/base-protocol.js"></script>
    <script src="downloaders/protocols/t5-protocols.js"></script>
    <script src="downloaders/configs/flash-config-base.js"></script>
    <script src="downloaders/configs/t5-flash-config.js"></script>
    <script src="downloaders/core/erase-strategy.js"></script>
    <script src="downloaders/core/write-strategy.js"></script>
    <script src="downloaders/core/crc-checker.js"></script>
    <script src="downloaders/utils/data-utils.js"></script>
    <script src="downloaders/utils/retry-utils.js"></script>
    <script src="downloaders/base-downloader.js"></script>

    <script>
        // å…¨å±€å˜é‡
        let testResults = {};
        let totalTests = 0;
        let passedTests = 0;

        // è¾…åŠ©å‡½æ•°
        function logResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = message;
            element.appendChild(div);
        }

        function clearResults(elementId) {
            document.getElementById(elementId).innerHTML = '';
        }

        // æµ‹è¯•1: æ¨¡å—åŠ è½½éªŒè¯
        function testModuleLoading() {
            clearResults('moduleLoadingResult');
            logResult('moduleLoadingResult', 'ğŸ”„ å¼€å§‹æ¨¡å—åŠ è½½éªŒè¯...', 'info');
            
            const modules = [
                { name: 'BaseProtocol', check: () => typeof BaseProtocol !== 'undefined' },
                { name: 'BaseBootRomProtocol', check: () => typeof BaseBootRomProtocol !== 'undefined' },
                { name: 'BaseBootRomFlashProtocol', check: () => typeof BaseBootRomFlashProtocol !== 'undefined' },
                { name: 'T5FlashConfig', check: () => typeof T5FlashConfig !== 'undefined' },
                { name: 'T5EraseStrategy', check: () => typeof T5EraseStrategy !== 'undefined' },
                { name: 'T5WriteStrategy', check: () => typeof T5WriteStrategy !== 'undefined' },
                { name: 'LinkCheckProtocol', check: () => typeof LinkCheckProtocol !== 'undefined' },
                { name: 'GetChipIdProtocol', check: () => typeof GetChipIdProtocol !== 'undefined' },
                { name: 'FlashCustomEraseProtocol', check: () => typeof FlashCustomEraseProtocol !== 'undefined' }
            ];
            
            let passed = 0;
            modules.forEach(module => {
                try {
                    if (module.check()) {
                        logResult('moduleLoadingResult', `âœ… ${module.name} åŠ è½½æˆåŠŸ`, 'success');
                        passed++;
                    } else {
                        logResult('moduleLoadingResult', `âŒ ${module.name} åŠ è½½å¤±è´¥`, 'error');
                    }
                } catch (error) {
                    logResult('moduleLoadingResult', `âŒ ${module.name} æ£€æŸ¥å¼‚å¸¸: ${error.message}`, 'error');
                }
            });
            
            const success = passed === modules.length;
            testResults.moduleLoading = success;
            totalTests++;
            if (success) passedTests++;
            
            logResult('moduleLoadingResult', 
                `ğŸ“Š æ¨¡å—åŠ è½½æµ‹è¯•å®Œæˆ: ${passed}/${modules.length} é€šè¿‡ ${success ? 'âœ…' : 'âŒ'}`, 
                success ? 'success' : 'error');
        }

        // æµ‹è¯•2: Flashé…ç½®éªŒè¯
        function testFlashConfig() {
            clearResults('flashConfigResult');
            logResult('flashConfigResult', 'ğŸ”„ å¼€å§‹Flashé…ç½®éªŒè¯...', 'info');
            
            try {
                const flashConfig = new T5FlashConfig();
                const supportedFlash = flashConfig.getSupportedFlashList();
                
                // éªŒè¯Flashæ•°é‡
                const expectedCount = 39;
                const actualCount = supportedFlash.length;
                
                if (actualCount === expectedCount) {
                    logResult('flashConfigResult', `âœ… Flashå‹å·æ•°é‡æ­£ç¡®: ${actualCount}/39`, 'success');
                } else {
                    logResult('flashConfigResult', `âŒ Flashå‹å·æ•°é‡é”™è¯¯: ${actualCount}/39`, 'error');
                }
                
                // éªŒè¯å…³é”®Flashå‹å·
                const keyFlashIds = [
                    0x00134051, // MD25D40D
                    0x001340c8, // GD25Q41B
                    0x001565c8, // GD25WQ16E (ä¹‹å‰ç¼ºå¤±)
                    0x00124485, // PY25D22U (ä¹‹å‰ç¼ºå¤±)
                    0x001260b3  // UC25HQ20
                ];
                
                let keyFlashFound = 0;
                keyFlashIds.forEach(flashId => {
                    const found = supportedFlash.find(flash => 
                        parseInt(flash.flashId, 16) === flashId);
                    if (found) {
                        logResult('flashConfigResult', 
                            `âœ… å…³é”®Flashå‹å·å­˜åœ¨: ${found.name} (${found.flashId})`, 'success');
                        keyFlashFound++;
                    } else {
                        logResult('flashConfigResult', 
                            `âŒ å…³é”®Flashå‹å·ç¼ºå¤±: 0x${flashId.toString(16)}`, 'error');
                    }
                });
                
                // æ˜¾ç¤ºå®Œæ•´Flashåˆ—è¡¨
                const flashListElement = document.getElementById('flashList');
                flashListElement.style.display = 'block';
                flashListElement.innerHTML = '<h4>æ”¯æŒçš„Flashå‹å·åˆ—è¡¨:</h4>';
                
                supportedFlash.forEach(flash => {
                    const div = document.createElement('div');
                    div.className = 'flash-item';
                    div.textContent = `${flash.flashId} | ${flash.manufacturer} ${flash.name} | ${flash.sizeBytes/1024/1024}MB`;
                    flashListElement.appendChild(div);
                });
                
                const success = actualCount === expectedCount && keyFlashFound === keyFlashIds.length;
                testResults.flashConfig = success;
                totalTests++;
                if (success) passedTests++;
                
                logResult('flashConfigResult', 
                    `ğŸ“Š Flashé…ç½®æµ‹è¯•å®Œæˆ ${success ? 'âœ…' : 'âŒ'}`, 
                    success ? 'success' : 'error');
                    
            } catch (error) {
                logResult('flashConfigResult', `âŒ Flashé…ç½®æµ‹è¯•å¼‚å¸¸: ${error.message}`, 'error');
                testResults.flashConfig = false;
                totalTests++;
            }
        }

        // æµ‹è¯•3: åè®®ç³»ç»ŸéªŒè¯
        function testProtocols() {
            clearResults('protocolResult');
            logResult('protocolResult', 'ğŸ”„ å¼€å§‹åè®®ç³»ç»ŸéªŒè¯...', 'info');
            
            const protocols = [
                'LinkCheckProtocol', 'GetChipIdProtocol', 'GetFlashMidProtocol',
                'SetBaudrateProtocol', 'FlashReadSRProtocol', 'FlashWriteSRProtocol',
                'FlashErase4kProtocol', 'FlashErase4kExtProtocol', 'FlashCustomEraseProtocol',
                'FlashRead4kProtocol', 'FlashRead4kExtProtocol', 'FlashWrite4kProtocol',
                'FlashWrite4kExtProtocol', 'CheckCrcProtocol', 'CheckCrcExtProtocol',
                'RebootProtocol', 'StayRomProtocol', 'FlashEraseAllProtocol',
                'GetBootVersionProtocol', 'ResetProtocol', 'WriteRegProtocol'
            ];
            
            let protocolsPassed = 0;
            protocols.forEach(protocolName => {
                try {
                    if (typeof window[protocolName] !== 'undefined') {
                        // å°è¯•åˆ›å»ºåè®®å®ä¾‹
                        const instance = new window[protocolName]();
                        if (instance && typeof instance.cmd === 'function') {
                            logResult('protocolResult', `âœ… ${protocolName} æ­£å¸¸`, 'success');
                            protocolsPassed++;
                        } else {
                            logResult('protocolResult', `âŒ ${protocolName} æ–¹æ³•ç¼ºå¤±`, 'error');
                        }
                    } else {
                        logResult('protocolResult', `âŒ ${protocolName} æœªå®šä¹‰`, 'error');
                    }
                } catch (error) {
                    logResult('protocolResult', `âŒ ${protocolName} åˆ›å»ºå¤±è´¥: ${error.message}`, 'error');
                }
            });
            
            const success = protocolsPassed === protocols.length;
            testResults.protocols = success;
            totalTests++;
            if (success) passedTests++;
            
            logResult('protocolResult', 
                `ğŸ“Š åè®®ç³»ç»Ÿæµ‹è¯•å®Œæˆ: ${protocolsPassed}/${protocols.length} é€šè¿‡ ${success ? 'âœ…' : 'âŒ'}`, 
                success ? 'success' : 'error');
        }

        // æµ‹è¯•4: æ™ºèƒ½æ“¦é™¤ç­–ç•¥éªŒè¯
        function testEraseStrategy() {
            clearResults('eraseStrategyResult');
            logResult('eraseStrategyResult', 'ğŸ”„ å¼€å§‹æ™ºèƒ½æ“¦é™¤ç­–ç•¥éªŒè¯...', 'info');
            
            try {
                // åˆ›å»ºæ¨¡æ‹Ÿçš„ä¸²å£å¤„ç†å™¨å’ŒFlashé…ç½®
                const mockSerialHandler = {
                    protocols: { flashCustomErase: { executeProtocol: () => Promise.resolve() } },
                    executeProtocol: () => Promise.resolve()
                };
                
                const mockFlashConfig = {
                    flashSize: 4 * 1024 * 1024, // 4MB
                    isInitialized: () => true
                };
                
                const eraseStrategy = new T5EraseStrategy(mockSerialHandler, mockFlashConfig, true);
                
                // æµ‹è¯•æ“¦é™¤èŒƒå›´è®¡ç®—
                const testCases = [
                    { startAddr: 0x0000, dataLength: 0x1000, expectedSize: 0x1000 },
                    { startAddr: 0x0000, dataLength: 0x10000, expectedSize: 0x10000 },
                    { startAddr: 0x1234, dataLength: 0x2000, expectedSize: 0x2000 }
                ];
                
                let casesPassed = 0;
                testCases.forEach((testCase, index) => {
                    const result = eraseStrategy.calculateEraseRange(testCase.startAddr, testCase.dataLength);
                    if (result.eraseSize === testCase.expectedSize) {
                        logResult('eraseStrategyResult', 
                            `âœ… æ“¦é™¤èŒƒå›´è®¡ç®—æµ‹è¯•${index + 1}: 0x${result.eraseSize.toString(16)} (æœŸæœ›: 0x${testCase.expectedSize.toString(16)})`, 
                            'success');
                        casesPassed++;
                    } else {
                        logResult('eraseStrategyResult', 
                            `âŒ æ“¦é™¤èŒƒå›´è®¡ç®—æµ‹è¯•${index + 1}: 0x${result.eraseSize.toString(16)} (æœŸæœ›: 0x${testCase.expectedSize.toString(16)})`, 
                            'error');
                    }
                });
                
                // æµ‹è¯•æ“¦é™¤å‘½ä»¤é€‰æ‹©
                const normalCmd = eraseStrategy.getEraseCommand('sector4K');
                const blockCmd = eraseStrategy.getEraseCommand('block64K');
                
                if (normalCmd === 0x20 && blockCmd === 0xd8) {
                    logResult('eraseStrategyResult', 'âœ… æ“¦é™¤å‘½ä»¤é€‰æ‹©æ­£ç¡® (4K:0x20, 64K:0xd8)', 'success');
                    casesPassed++;
                } else {
                    logResult('eraseStrategyResult', `âŒ æ“¦é™¤å‘½ä»¤é€‰æ‹©é”™è¯¯ (4K:0x${normalCmd.toString(16)}, 64K:0x${blockCmd.toString(16)})`, 'error');
                }
                
                const success = casesPassed === testCases.length + 1;
                testResults.eraseStrategy = success;
                totalTests++;
                if (success) passedTests++;
                
                logResult('eraseStrategyResult', 
                    `ğŸ“Š æ™ºèƒ½æ“¦é™¤ç­–ç•¥æµ‹è¯•å®Œæˆ ${success ? 'âœ…' : 'âŒ'}`, 
                    success ? 'success' : 'error');
                    
            } catch (error) {
                logResult('eraseStrategyResult', `âŒ æ™ºèƒ½æ“¦é™¤ç­–ç•¥æµ‹è¯•å¼‚å¸¸: ${error.message}`, 'error');
                testResults.eraseStrategy = false;
                totalTests++;
            }
        }

        // æµ‹è¯•5: åœ°å€å¯¹é½å¤„ç†éªŒè¯
        function testAddressAlignment() {
            clearResults('addressAlignmentResult');
            logResult('addressAlignmentResult', 'ğŸ”„ å¼€å§‹åœ°å€å¯¹é½å¤„ç†éªŒè¯...', 'info');
            
            try {
                // åˆ›å»ºæ¨¡æ‹Ÿçš„ä¸²å£å¤„ç†å™¨å’ŒFlashé…ç½®
                const mockSerialHandler = {
                    protocols: { 
                        flashRead4k: { getReadContent: (data) => new Uint8Array(4096).fill(0xff) },
                        flashWrite4k: {},
                        checkCrc: {}
                    },
                    executeProtocol: () => Promise.resolve(new Uint8Array(4096).fill(0xff))
                };
                
                const mockFlashConfig = {
                    flashSize: 4 * 1024 * 1024,
                    isInitialized: () => true
                };
                
                const writeStrategy = new T5WriteStrategy(mockSerialHandler, mockFlashConfig, true);
                
                // æµ‹è¯•åœ°å€å¯¹é½ç®—æ³•
                const testCases = [
                    { addr: 0x1234, expected: { sectorAddr: 0x1000, offset: 0x234 } },
                    { addr: 0x5678, expected: { sectorAddr: 0x5000, offset: 0x678 } },
                    { addr: 0x0000, expected: { sectorAddr: 0x0000, offset: 0x000 } }
                ];
                
                let casesPassed = 0;
                testCases.forEach((testCase, index) => {
                    const sectorAddr = Math.floor(testCase.addr / 0x1000) * 0x1000;
                    const offset = testCase.addr & 0xfff;
                    
                    if (sectorAddr === testCase.expected.sectorAddr && offset === testCase.expected.offset) {
                        logResult('addressAlignmentResult', 
                            `âœ… åœ°å€å¯¹é½è®¡ç®—æµ‹è¯•${index + 1}: 0x${testCase.addr.toString(16)} â†’ æ‰‡åŒº:0x${sectorAddr.toString(16)}, åç§»:0x${offset.toString(16)}`, 
                            'success');
                        casesPassed++;
                    } else {
                        logResult('addressAlignmentResult', 
                            `âŒ åœ°å€å¯¹é½è®¡ç®—æµ‹è¯•${index + 1}: è®¡ç®—é”™è¯¯`, 'error');
                    }
                });
                
                // æµ‹è¯•0xFFæ£€æŸ¥
                const allFF = new Uint8Array(100).fill(0xff);
                const notAllFF = new Uint8Array(100).fill(0xff);
                notAllFF[50] = 0x00;
                
                if (writeStrategy.isBufferAll0xFF(allFF) && !writeStrategy.isBufferAll0xFF(notAllFF)) {
                    logResult('addressAlignmentResult', 'âœ… 0xFFæ£€æŸ¥åŠŸèƒ½æ­£å¸¸', 'success');
                    casesPassed++;
                } else {
                    logResult('addressAlignmentResult', 'âŒ 0xFFæ£€æŸ¥åŠŸèƒ½å¼‚å¸¸', 'error');
                }
                
                const success = casesPassed === testCases.length + 1;
                testResults.addressAlignment = success;
                totalTests++;
                if (success) passedTests++;
                
                logResult('addressAlignmentResult', 
                    `ğŸ“Š åœ°å€å¯¹é½å¤„ç†æµ‹è¯•å®Œæˆ ${success ? 'âœ…' : 'âŒ'}`, 
                    success ? 'success' : 'error');
                    
            } catch (error) {
                logResult('addressAlignmentResult', `âŒ åœ°å€å¯¹é½å¤„ç†æµ‹è¯•å¼‚å¸¸: ${error.message}`, 'error');
                testResults.addressAlignment = false;
                totalTests++;
            }
        }

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            const button = document.getElementById('runAllBtn');
            button.disabled = true;
            button.textContent = 'æµ‹è¯•è¿›è¡Œä¸­...';
            
            clearResults('comprehensiveResult');
            logResult('comprehensiveResult', 'ğŸš€ å¼€å§‹ç»¼åˆåŠŸèƒ½éªŒè¯...', 'info');
            
            // é‡ç½®ç»Ÿè®¡
            testResults = {};
            totalTests = 0;
            passedTests = 0;
            
            // ä¾æ¬¡è¿è¡Œæ‰€æœ‰æµ‹è¯•
            testModuleLoading();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            testFlashConfig();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            testProtocols();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            testEraseStrategy();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            testAddressAlignment();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // ç”Ÿæˆç»¼åˆæŠ¥å‘Š
            const passRate = totalTests > 0 ? (passedTests / totalTests * 100).toFixed(1) : 0;
            const overallSuccess = passedTests === totalTests;
            
            logResult('comprehensiveResult', `ğŸ“Š æµ‹è¯•å®Œæˆç»Ÿè®¡: ${passedTests}/${totalTests} é€šè¿‡ (${passRate}%)`, 'info');
            
            if (overallSuccess) {
                logResult('comprehensiveResult', 
                    'ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼JSç‰ˆæœ¬T5ä¸‹è½½å™¨å·²è¾¾åˆ°Pythonç‰ˆæœ¬åŠŸèƒ½æ°´å¹³', 'success');
                logResult('comprehensiveResult', 
                    'âœ… åŠŸèƒ½å®Œæ•´æ€§: æ™ºèƒ½æ“¦é™¤ç­–ç•¥ã€åœ°å€å¯¹é½å¤„ç†ã€39ç§Flashæ”¯æŒ', 'success');
                logResult('comprehensiveResult', 
                    'âœ… åè®®å…¼å®¹æ€§: 21ä¸ªåè®®100%å…¼å®¹Pythonç‰ˆæœ¬', 'success');
                logResult('comprehensiveResult', 
                    'âœ… æ¶æ„ä¼˜åŒ–: æ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•', 'success');
            } else {
                logResult('comprehensiveResult', 
                    'âŒ éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥å…·ä½“é”™è¯¯ä¿¡æ¯', 'error');
            }
            
            // ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š
            const reportHTML = generateDetailedReport();
            logResult('comprehensiveResult', reportHTML, 'info');
            
            button.disabled = false;
            button.textContent = 'è¿è¡Œæ‰€æœ‰æµ‹è¯•';
        }

        // ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š
        function generateDetailedReport() {
            const timestamp = new Date().toLocaleString('zh-CN');
            return `
                <pre>
=== T5ä¸‹è½½å™¨æ”¹è¿›éªŒè¯æŠ¥å‘Š ===
éªŒè¯æ—¶é—´: ${timestamp}
éªŒè¯ç¯å¢ƒ: ${navigator.userAgent}

æµ‹è¯•ç»“æœæ¦‚è§ˆ:
âœ“ æ¨¡å—åŠ è½½éªŒè¯: ${testResults.moduleLoading ? 'PASS' : 'FAIL'}
âœ“ Flashé…ç½®éªŒè¯: ${testResults.flashConfig ? 'PASS' : 'FAIL'}  
âœ“ åè®®ç³»ç»ŸéªŒè¯: ${testResults.protocols ? 'PASS' : 'FAIL'}
âœ“ æ™ºèƒ½æ“¦é™¤ç­–ç•¥: ${testResults.eraseStrategy ? 'PASS' : 'FAIL'}
âœ“ åœ°å€å¯¹é½å¤„ç†: ${testResults.addressAlignment ? 'PASS' : 'FAIL'}

æ€»ä½“è¯„ä¼°: ${passedTests}/${totalTests} é€šè¿‡ (${totalTests > 0 ? (passedTests/totalTests*100).toFixed(1) : 0}%)

æ”¹è¿›æˆæœç¡®è®¤:
${passedTests === totalTests ? 'ğŸ‰' : 'âŒ'} JSç‰ˆæœ¬å·²è¾¾åˆ°Pythonç‰ˆæœ¬åŠŸèƒ½æ°´å¹³
${testResults.eraseStrategy ? 'âœ…' : 'âŒ'} æ™ºèƒ½æ“¦é™¤ç­–ç•¥ (4K/32K/64Kè‡ªé€‚åº”)
${testResults.addressAlignment ? 'âœ…' : 'âŒ'} åœ°å€å¯¹é½å¤„ç† (ä»»æ„åœ°å€å†™å…¥)
${testResults.flashConfig ? 'âœ…' : 'âŒ'} Flashé…ç½®å®Œæ•´ (39ç§å‹å·æ”¯æŒ)
${testResults.protocols ? 'âœ…' : 'âŒ'} åè®®ç³»ç»Ÿå®Œå–„ (21ä¸ªåè®®å…¼å®¹)
${testResults.moduleLoading ? 'âœ…' : 'âŒ'} æ¨¡å—åŒ–æ¶æ„ (æ¸…æ™°èŒè´£åˆ†ç¦»)

å»ºè®®: ${passedTests === totalTests ? 
    'æ‰€æœ‰åŠŸèƒ½éªŒè¯é€šè¿‡ï¼Œå¯ä»¥æŠ•å…¥ç”Ÿäº§ä½¿ç”¨' : 
    'å­˜åœ¨åŠŸèƒ½é—®é¢˜ï¼Œå»ºè®®æ£€æŸ¥å¤±è´¥çš„æµ‹è¯•é¡¹ç›®'}
                </pre>
            `;
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ T5ä¸‹è½½å™¨æ”¹è¿›åŠŸèƒ½éªŒè¯å·¥å…·å·²åŠ è½½');
            console.log('ğŸ’¡ ç‚¹å‡»å„ä¸ªæµ‹è¯•æŒ‰é’®éªŒè¯æ”¹è¿›åŠŸèƒ½');
            console.log('ğŸ“Š è¿è¡Œ"è¿è¡Œæ‰€æœ‰æµ‹è¯•"è·å–å®Œæ•´éªŒè¯æŠ¥å‘Š');
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON ÂèØËßÜÂåñÂ∑•ÂÖ∑</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            height: calc(100vh - 40px);
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
        }

        .header h1 {
            font-size: 1.8em;
            margin: 0;
        }

        .header-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .btn.primary {
            background: rgba(255, 255, 255, 0.9);
            color: #667eea;
        }

        .btn.primary:hover {
            background: white;
        }

        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
            position: relative;
            border: 1px solid #eee;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .editor-panel, .viewer-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            min-width: 0;
            width: 50%;
            box-sizing: border-box;
        }

        .editor-panel {
            border-right: 1px solid #eee;
        }

        .panel-collapsed {
            width: 0 !important;
            min-width: 0 !important;
            max-width: 0 !important;
            opacity: 0;
            overflow: hidden !important;
            border: none !important;
            position: relative;
            padding: 0 !important;
            margin: 0 !important;
            flex: 0 !important;
        }

        .panel-collapsed * {
            visibility: hidden;
        }

        .panel-expanded {
            width: 100% !important;
            flex: 1 1 100% !important;
            transition: all 0.3s ease;
        }

        /* ÊäòÂè†Èù¢ÊùøÁöÑÂ±ïÂºÄÊåâÈíÆ */
        .expand-handle {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            width: 28px;
            height: 60px;
            background: rgba(102, 126, 234, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
            font-weight: bold;
            font-family: monospace;
            z-index: 9999;
            box-shadow: 0 3px 10px rgba(0,0,0,0.25);
            transition: all 0.2s ease;
            backdrop-filter: blur(10px);
            opacity: 0.9;
        }

        .expand-handle:hover {
            width: 36px;
            background: rgba(118, 75, 162, 1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.4);
            transform: translateY(-50%) scale(1.05);
        }

        /* Á°Æ‰øùÂ±ïÂºÄÊåâÈíÆ‰∏çÂèóÈù¢ÊùøÊäòÂè†ÁöÑÂΩ±Âìç */
        #expandEditorBtn, #expandViewerBtn {
            visibility: visible !important;
        }

        /* ÁºñËæëÂô®Â±ïÂºÄÊåâÈíÆ‰ΩçÁΩÆ */
        #expandEditorBtn {
            left: 0;
            border-radius: 0 12px 12px 0;
        }

        /* È¢ÑËßàÂ±ïÂºÄÊåâÈíÆ‰ΩçÁΩÆ */
        #expandViewerBtn {
            right: 0;
            border-radius: 12px 0 0 12px;
        }

        .panel-header {
            background: #f8f9ff;
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            font-weight: 600;
            color: #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .collapse-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .collapse-btn:hover {
            background: #218838;
            transform: scale(1.05);
        }

        .collapse-btn.expand {
            background: #007bff;
        }

        .collapse-btn.expand:hover {
            background: #0056b3;
        }

        .panel-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 5px 12px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.3s ease;
        }

        .panel-btn:hover {
            background: #764ba2;
            transform: scale(1.05);
        }

        .code-editor {
            flex: 1;
            margin: 0;
            padding: 20px;
            border: none;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: none;
            outline: none;
            background: #f8f9ff;
        }

        .json-viewer {
            flex: 1;
            padding: 20px;
            overflow: auto;
            background: #fafbff;
        }

        .json-node {
            margin-left: 20px;
        }

        .json-key {
            color: #0066cc;
            font-weight: 600;
            cursor: pointer;
        }

        .json-value {
            margin-left: 10px;
        }

        .json-value.string {
            color: #22863a;
        }

        .json-value.number {
            color: #005cc5;
        }

        .json-value.boolean {
            color: #d73a49;
        }

        .json-value.null {
            color: #6f42c1;
        }

        .json-object, .json-array {
            border-left: 2px solid #e1e4e8;
            margin-left: 10px;
            padding-left: 15px;
        }

        .json-toggle {
            display: inline-block;
            width: 16px;
            height: 16px;
            background: #667eea;
            color: white;
            text-align: center;
            line-height: 16px;
            font-size: 12px;
            border-radius: 50%;
            cursor: pointer;
            margin-right: 5px;
            user-select: none;
        }

        .json-toggle:hover {
            background: #764ba2;
        }

        .json-collapsed {
            display: none;
        }

        .json-item {
            display: flex;
            align-items: flex-start;
            margin: 5px 0;
            padding: 3px 0;
            border-radius: 3px;
            transition: background 0.2s ease;
        }

        .json-item:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .json-controls {
            display: none;
            margin-left: auto;
            gap: 5px;
        }

        .json-item:hover .json-controls {
            display: flex;
        }

        .control-btn {
            width: 20px;
            height: 20px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .control-btn.add {
            background: #28a745;
            color: white;
        }

        .control-btn.edit {
            background: #ffc107;
            color: #333;
        }

        .control-btn.delete {
            background: #dc3545;
            color: white;
        }

        .control-btn:hover {
            transform: scale(1.1);
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px 20px;
            border-left: 4px solid #dc3545;
            margin: 20px;
            border-radius: 5px;
        }

        .toolbar {
            display: flex;
            gap: 10px;
            align-items: center;
            padding: 0 10px;
        }

        .search-box {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 15px;
            font-size: 12px;
            outline: none;
        }

        .search-box:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 400px;
            max-width: 90%;
        }

        .modal-header {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .modal-btn {
            padding: 8px 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .modal-btn.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .modal-btn.secondary {
            background: #f8f9fa;
            color: #6c757d;
            border: 1px solid #dee2e6;
        }

        .modal-btn:hover {
            transform: translateY(-1px);
        }

        .status-bar {
            background: #f8f9ff;
            padding: 8px 20px;
            border-top: 1px solid #eee;
            font-size: 12px;
            color: #666;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* ÈÄöÁü•Âä®Áîª */
        @keyframes slideInNotification {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutNotification {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .editor-panel, .viewer-panel {
                width: 100% !important;
                height: 50vh;
            }
            
            .editor-panel {
                border-right: none;
                border-bottom: 1px solid #eee;
            }
            
            .panel-collapsed {
                height: 0 !important;
                min-height: 0 !important;
            }
            
            .panel-expanded {
                height: calc(100vh - 140px) !important;
            }

            /* ÁßªÂä®Á´ØÂ±ïÂºÄÊåâÈíÆÊ†∑Âºè */
            .expand-handle {
                width: 50px !important;
                height: 32px !important;
                font-size: 12px !important;
                border-radius: 0 0 12px 12px !important;
                left: 50% !important;
                right: auto !important;
                transform: translateX(-50%) !important;
                top: 0 !important;
            }

            .expand-handle:hover {
                width: 55px !important;
            }

            .editor-panel.panel-collapsed .expand-handle {
                top: 0 !important;
                transform: translateX(-50%) !important;
            }

            .viewer-panel.panel-collapsed .expand-handle {
                top: 0 !important;
                transform: translateX(-50%) !important;
            }
            
            .header {
                padding: 15px 20px;
            }
            
            .header h1 {
                font-size: 1.5em;
            }
            
            .header-controls {
                flex-wrap: wrap;
            }
            
            .toolbar {
                flex-wrap: wrap;
                gap: 5px;
            }
            
            .search-box {
                min-width: 120px;
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç JSON ÂèØËßÜÂåñÂ∑•ÂÖ∑</h1>
            <div class="header-controls">
                <button class="btn" onclick="importFile()">üìÅ ÂØºÂÖ•</button>
                <button class="btn" onclick="exportFile()">üíæ ÂØºÂá∫</button>
                <button class="btn" onclick="formatJson()">‚ú® Ê†ºÂºèÂåñ</button>
                <button class="btn" onclick="compressJson()">üóúÔ∏è ÂéãÁº©</button>
                <button class="btn" onclick="resetPanels()" id="resetPanelsBtn" style="display: none;">üîÑ ÊÅ¢Â§çÈù¢Êùø</button>
                <button class="btn primary" onclick="validateJson()">‚úÖ È™åËØÅ</button>
            </div>
        </div>

        <div class="main-content">
            <button class="expand-handle" id="expandEditorBtn" onclick="togglePanel('editor')" title="Â±ïÂºÄÁºñËæëÂô®">
                &gt;&gt;
            </button>
            <div class="editor-panel">
                <div class="panel-header">
                    üìù JSON ÁºñËæëÂô®
                    <div class="panel-controls">
                        <button class="collapse-btn" id="collapseEditor" onclick="togglePanel('editor')" title="ÊäòÂè†ÁºñËæëÂô®">
                            ‚óÑ ÊäòÂè†
                        </button>
                        <button class="panel-btn" onclick="clearEditor()">Ê∏ÖÁ©∫</button>
                        <button class="panel-btn" onclick="loadSample()">Á§∫‰æã</button>
                    </div>
                </div>
                <textarea id="jsonEditor" class="code-editor" placeholder="Âú®Ê≠§ËæìÂÖ•ÊàñÁ≤òË¥¥ÊÇ®ÁöÑJSONÊï∞ÊçÆ...">{
  "name": "Á§∫‰æãÊï∞ÊçÆ",
  "version": "1.0.0",
  "users": [
    {
      "id": 1,
      "name": "Âº†‰∏â",
      "email": "zhangsan@example.com",
      "active": true,
      "profile": {
        "age": 25,
        "city": "Âåó‰∫¨",
        "hobbies": ["ÈòÖËØª", "Ê∏∏Ê≥≥", "ÁºñÁ®ã"]
      }
    },
    {
      "id": 2,
      "name": "ÊùéÂõõ",
      "email": "lisi@example.com",
      "active": false,
      "profile": {
        "age": 30,
        "city": "‰∏äÊµ∑",
        "hobbies": ["Èü≥‰πê", "ÊóÖË°å"]
      }
    }
  ],
  "settings": {
    "theme": "dark",
    "notifications": true,
    "maxUsers": 100
  }
}</textarea>
            </div>

            <button class="expand-handle" id="expandViewerBtn" onclick="togglePanel('viewer')" title="Â±ïÂºÄÈ¢ÑËßà">
                &lt;&lt;
            </button>
            
            <div class="viewer-panel">
                <div class="panel-header">
                    üå≥ ÂèØËßÜÂåñËßÜÂõæ
                    <div class="toolbar">
                        <input type="text" id="searchBox" class="search-box" placeholder="ÊêúÁ¥¢..." onkeyup="searchJson(this.value)">
                        <div class="panel-controls">
                            <button class="collapse-btn" id="collapseViewer" onclick="togglePanel('viewer')" title="ÊäòÂè†È¢ÑËßà">
                                ÊäòÂè† ‚ñ∫
                            </button>
                            <button class="panel-btn" onclick="expandAll()">Â±ïÂºÄÂÖ®ÈÉ®</button>
                            <button class="panel-btn" onclick="collapseAll()">ÊäòÂè†ÂÖ®ÈÉ®</button>
                        </div>
                    </div>
                </div>
                <div id="jsonViewer" class="json-viewer">
                    <!-- JSONËßÜÂõæÂ∞ÜÂú®ËøôÈáåÊ∏≤Êüì -->
                </div>
            </div>
        </div>

        <div class="status-bar">
            <span id="statusText">Â∞±Áª™</span>
            <span id="jsonStats">Ë°åÊï∞: 0 | Â≠óÁ¨¶Êï∞: 0</span>
        </div>
    </div>

    <!-- ÁºñËæëÊ®°ÊÄÅÊ°Ü -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">ÁºñËæëËäÇÁÇπ</div>
            <div class="form-group">
                <label>ÈîÆÂêç:</label>
                <input type="text" id="editKey" placeholder="ËæìÂÖ•ÈîÆÂêç">
            </div>
            <div class="form-group">
                <label>ÂÄºÁ±ªÂûã:</label>
                <select id="editType" onchange="updateValueInput()">
                    <option value="string">Â≠óÁ¨¶‰∏≤</option>
                    <option value="number">Êï∞Â≠ó</option>
                    <option value="boolean">Â∏ÉÂ∞îÂÄº</option>
                    <option value="null">Á©∫ÂÄº</option>
                    <option value="object">ÂØπË±°</option>
                    <option value="array">Êï∞ÁªÑ</option>
                </select>
            </div>
            <div class="form-group">
                <label>ÂÄº:</label>
                <input type="text" id="editValue" placeholder="ËæìÂÖ•ÂÄº">
                <textarea id="editValueText" style="display: none;" rows="4" placeholder="ËæìÂÖ•JSONÂØπË±°ÊàñÊï∞ÁªÑ"></textarea>
            </div>
            <div class="modal-actions">
                <button class="modal-btn secondary" onclick="closeModal()">ÂèñÊ∂à</button>
                <button class="modal-btn primary" onclick="saveEdit()">‰øùÂ≠ò</button>
            </div>
        </div>
    </div>

    <!-- ÈöêËóèÁöÑÊñá‰ª∂ËæìÂÖ• -->
    <input type="file" id="fileInput" accept=".json" style="display: none;" onchange="handleFileImport(event)">

    <script>
        let jsonData = {};
        let currentEditPath = null;

        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            const editor = document.getElementById('jsonEditor');
            editor.addEventListener('input', debounce(updateViewer, 300));
            updateViewer();
            
            // Á°Æ‰øùÂ±ïÂºÄÊåâÈíÆÂàùÂßãÁä∂ÊÄÅÊ≠£Á°Æ
            const expandEditorBtn = document.getElementById('expandEditorBtn');
            const expandViewerBtn = document.getElementById('expandViewerBtn');
            expandEditorBtn.style.display = 'none'; // ÂàùÂßãÈöêËóè
            expandViewerBtn.style.display = 'none'; // ÂàùÂßãÈöêËóè
            
            // Ê∑ªÂä†ÈîÆÁõòÂø´Êç∑ÈîÆÊîØÊåÅ
            document.addEventListener('keydown', function(e) {
                // Ctrl+Tab ÂàáÊç¢Èù¢Êùø
                if (e.ctrlKey && e.key === 'Tab') {
                    e.preventDefault();
                    const editorPanel = document.querySelector('.editor-panel');
                    const viewerPanel = document.querySelector('.viewer-panel');
                    
                    if (editorPanel.classList.contains('panel-collapsed')) {
                        togglePanel('editor'); // Â±ïÂºÄÁºñËæëÂô®
                    } else if (viewerPanel.classList.contains('panel-collapsed')) {
                        togglePanel('viewer'); // Â±ïÂºÄÈ¢ÑËßà
                    } else {
                        togglePanel('editor'); // ÈªòËÆ§ÊäòÂè†ÁºñËæëÂô®
                    }
                }
            });
            
            updatePanelButtonStates();
        });

        // Èò≤ÊäñÂáΩÊï∞
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Êõ¥Êñ∞Áä∂ÊÄÅÊ†è
        function updateStats() {
            const editor = document.getElementById('jsonEditor');
            const text = editor.value;
            const lines = text.split('\n').length;
            const chars = text.length;
            document.getElementById('jsonStats').textContent = `Ë°åÊï∞: ${lines} | Â≠óÁ¨¶Êï∞: ${chars}`;
        }

        // Êõ¥Êñ∞ËßÜÂõæ
        function updateViewer() {
            const editor = document.getElementById('jsonEditor');
            const viewer = document.getElementById('jsonViewer');
            const statusText = document.getElementById('statusText');
            
            updateStats();
            
            try {
                jsonData = JSON.parse(editor.value);
                viewer.innerHTML = renderJson(jsonData);
                statusText.textContent = '‚úÖ JSON Ê†ºÂºèÊ≠£Á°Æ';
                statusText.style.color = '#28a745';
            } catch (error) {
                viewer.innerHTML = `<div class="error-message">‚ùå JSON Ê†ºÂºèÈîôËØØ: ${error.message}</div>`;
                statusText.textContent = '‚ùå JSON Ê†ºÂºèÈîôËØØ';
                statusText.style.color = '#dc3545';
            }
        }

        // Ê∏≤ÊüìJSON
        function renderJson(data, path = '', level = 0) {
            if (data === null) {
                return `<span class="json-value null">null</span>`;
            }
            
            if (typeof data === 'string') {
                return `<span class="json-value string">"${escapeHtml(data)}"</span>`;
            }
            
            if (typeof data === 'number') {
                return `<span class="json-value number">${data}</span>`;
            }
            
            if (typeof data === 'boolean') {
                return `<span class="json-value boolean">${data}</span>`;
            }
            
            if (Array.isArray(data)) {
                if (data.length === 0) {
                    return `<span class="json-value">[]</span>`;
                }
                
                let html = `<div class="json-item">
                    <span class="json-toggle" onclick="toggleCollapse(this)">-</span>
                    <span class="json-key">[${data.length}]</span>
                    <div class="json-controls">
                        <button class="control-btn add" onclick="addItem('${path}', 'array')" title="Ê∑ªÂä†È°π">+</button>
                    </div>
                </div>`;
                html += `<div class="json-array">`;
                
                data.forEach((item, index) => {
                    const itemPath = path ? `${path}[${index}]` : `[${index}]`;
                    html += `<div class="json-item">
                        <span class="json-key">${index}:</span>
                        ${renderJson(item, itemPath, level + 1)}
                        <div class="json-controls">
                            <button class="control-btn edit" onclick="editItem('${itemPath}', ${index})" title="ÁºñËæë">‚úé</button>
                            <button class="control-btn delete" onclick="deleteItem('${itemPath}', ${index})" title="Âà†Èô§">√ó</button>
                        </div>
                    </div>`;
                });
                
                html += `</div>`;
                return html;
            }
            
            if (typeof data === 'object') {
                const keys = Object.keys(data);
                if (keys.length === 0) {
                    return `<span class="json-value">{}</span>`;
                }
                
                let html = `<div class="json-item">
                    <span class="json-toggle" onclick="toggleCollapse(this)">-</span>
                    <span class="json-key">{${keys.length}}</span>
                    <div class="json-controls">
                        <button class="control-btn add" onclick="addItem('${path}', 'object')" title="Ê∑ªÂä†Â±ûÊÄß">+</button>
                    </div>
                </div>`;
                html += `<div class="json-object">`;
                
                keys.forEach(key => {
                    const itemPath = path ? `${path}.${key}` : key;
                    html += `<div class="json-item">
                        <span class="json-key">"${escapeHtml(key)}":</span>
                        ${renderJson(data[key], itemPath, level + 1)}
                        <div class="json-controls">
                            <button class="control-btn edit" onclick="editItem('${itemPath}', '${key}')" title="ÁºñËæë">‚úé</button>
                            <button class="control-btn delete" onclick="deleteItem('${itemPath}', '${key}')" title="Âà†Èô§">√ó</button>
                        </div>
                    </div>`;
                });
                
                html += `</div>`;
                return html;
            }
            
            return `<span class="json-value">${String(data)}</span>`;
        }

        // HTMLËΩ¨‰πâ
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, function(m) { return map[m]; });
        }

        // ÂàáÊç¢ÊäòÂè†Áä∂ÊÄÅ
        function toggleCollapse(element) {
            const container = element.parentElement.nextElementSibling;
            if (container.style.display === 'none') {
                container.style.display = 'block';
                element.textContent = '-';
            } else {
                container.style.display = 'none';
                element.textContent = '+';
            }
        }

        // Â±ïÂºÄÂÖ®ÈÉ®
        function expandAll() {
            const toggles = document.querySelectorAll('.json-toggle');
            toggles.forEach(toggle => {
                const container = toggle.parentElement.nextElementSibling;
                container.style.display = 'block';
                toggle.textContent = '-';
            });
        }

        // ÊäòÂè†ÂÖ®ÈÉ®
        function collapseAll() {
            const toggles = document.querySelectorAll('.json-toggle');
            toggles.forEach(toggle => {
                const container = toggle.parentElement.nextElementSibling;
                container.style.display = 'none';
                toggle.textContent = '+';
            });
        }

        // ÊêúÁ¥¢JSON
        function searchJson(searchTerm) {
            const items = document.querySelectorAll('.json-item');
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(searchTerm.toLowerCase())) {
                    item.style.backgroundColor = searchTerm ? 'rgba(255, 235, 59, 0.3)' : '';
                } else {
                    item.style.backgroundColor = '';
                }
            });
        }

        // ÂØºÂÖ•Êñá‰ª∂
        function importFile() {
            document.getElementById('fileInput').click();
        }

        // Â§ÑÁêÜÊñá‰ª∂ÂØºÂÖ•
        function handleFileImport(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('jsonEditor').value = e.target.result;
                    updateViewer();
                };
                reader.readAsText(file);
            }
        }

        // ÂØºÂá∫Êñá‰ª∂
        function exportFile() {
            try {
                const json = JSON.stringify(jsonData, null, 2);
                const blob = new Blob([json], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'data.json';
                a.click();
                URL.revokeObjectURL(url);
            } catch (error) {
                alert('ÂØºÂá∫Â§±Ë¥•ÔºöJSON Ê†ºÂºè‰∏çÊ≠£Á°Æ');
            }
        }

        // Ê†ºÂºèÂåñJSON
        function formatJson() {
            try {
                const formatted = JSON.stringify(JSON.parse(document.getElementById('jsonEditor').value), null, 2);
                document.getElementById('jsonEditor').value = formatted;
                updateViewer();
            } catch (error) {
                alert('Ê†ºÂºèÂåñÂ§±Ë¥•ÔºöJSON Ê†ºÂºè‰∏çÊ≠£Á°Æ');
            }
        }

        // ÂéãÁº©JSON
        function compressJson() {
            try {
                const compressed = JSON.stringify(JSON.parse(document.getElementById('jsonEditor').value));
                document.getElementById('jsonEditor').value = compressed;
                updateViewer();
            } catch (error) {
                alert('ÂéãÁº©Â§±Ë¥•ÔºöJSON Ê†ºÂºè‰∏çÊ≠£Á°Æ');
            }
        }

        // È™åËØÅJSON
        function validateJson() {
            try {
                JSON.parse(document.getElementById('jsonEditor').value);
                alert('‚úÖ JSON Ê†ºÂºèÊ≠£Á°ÆÔºÅ');
            } catch (error) {
                alert(`‚ùå JSON Ê†ºÂºèÈîôËØØÔºö${error.message}`);
            }
        }

        // Ê∏ÖÁ©∫ÁºñËæëÂô®
        function clearEditor() {
            if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÁºñËæëÂô®ÂêóÔºü')) {
                document.getElementById('jsonEditor').value = '';
                updateViewer();
            }
        }

        // Âä†ËΩΩÁ§∫‰æã
        function loadSample() {
            const sample = {
                "name": "Á§∫‰æãÊï∞ÊçÆ",
                "version": "1.0.0",
                "users": [
                    {
                        "id": 1,
                        "name": "Âº†‰∏â",
                        "email": "zhangsan@example.com",
                        "active": true,
                        "profile": {
                            "age": 25,
                            "city": "Âåó‰∫¨",
                            "hobbies": ["ÈòÖËØª", "Ê∏∏Ê≥≥", "ÁºñÁ®ã"]
                        }
                    }
                ],
                "settings": {
                    "theme": "dark",
                    "notifications": true,
                    "maxUsers": 100
                }
            };
            document.getElementById('jsonEditor').value = JSON.stringify(sample, null, 2);
            updateViewer();
        }

        // Ê∑ªÂä†È°πÁõÆ
        function addItem(path, type) {
            currentEditPath = path;
            document.getElementById('editKey').value = '';
            document.getElementById('editValue').value = '';
            document.getElementById('editType').value = 'string';
            updateValueInput();
            
            if (type === 'array') {
                document.getElementById('editKey').parentElement.style.display = 'none';
            } else {
                document.getElementById('editKey').parentElement.style.display = 'block';
            }
            
            document.getElementById('editModal').classList.add('show');
        }

        // ÁºñËæëÈ°πÁõÆ
        function editItem(path, key) {
            currentEditPath = path;
            const value = getValueByPath(jsonData, path);
            
            document.getElementById('editKey').value = key;
            document.getElementById('editKey').parentElement.style.display = 'block';
            
            if (typeof value === 'object' && value !== null) {
                document.getElementById('editType').value = Array.isArray(value) ? 'array' : 'object';
                document.getElementById('editValueText').value = JSON.stringify(value, null, 2);
            } else {
                document.getElementById('editType').value = value === null ? 'null' : typeof value;
                document.getElementById('editValue').value = value === null ? '' : String(value);
            }
            
            updateValueInput();
            document.getElementById('editModal').classList.add('show');
        }

        // Âà†Èô§È°πÁõÆ
        function deleteItem(path, key) {
            if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ê≠§È°πÁõÆÂêóÔºü')) {
                deleteValueByPath(jsonData, path);
                document.getElementById('jsonEditor').value = JSON.stringify(jsonData, null, 2);
                updateViewer();
            }
        }

        // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
        function closeModal() {
            document.getElementById('editModal').classList.remove('show');
        }

        // Êõ¥Êñ∞ÂÄºËæìÂÖ•Ê°Ü
        function updateValueInput() {
            const type = document.getElementById('editType').value;
            const valueInput = document.getElementById('editValue');
            const valueTextarea = document.getElementById('editValueText');
            
            if (type === 'object' || type === 'array') {
                valueInput.style.display = 'none';
                valueTextarea.style.display = 'block';
            } else {
                valueInput.style.display = 'block';
                valueTextarea.style.display = 'none';
            }
        }

        // ‰øùÂ≠òÁºñËæë
        function saveEdit() {
            const key = document.getElementById('editKey').value;
            const type = document.getElementById('editType').value;
            let value;
            
            try {
                if (type === 'object' || type === 'array') {
                    value = JSON.parse(document.getElementById('editValueText').value);
                } else if (type === 'number') {
                    value = Number(document.getElementById('editValue').value);
                } else if (type === 'boolean') {
                    value = document.getElementById('editValue').value.toLowerCase() === 'true';
                } else if (type === 'null') {
                    value = null;
                } else {
                    value = document.getElementById('editValue').value;
                }
                
                setValueByPath(jsonData, currentEditPath, key, value);
                document.getElementById('jsonEditor').value = JSON.stringify(jsonData, null, 2);
                updateViewer();
                closeModal();
            } catch (error) {
                alert('‰øùÂ≠òÂ§±Ë¥•Ôºö' + error.message);
            }
        }

        // Ê†πÊçÆË∑ØÂæÑËé∑ÂèñÂÄº
        function getValueByPath(obj, path) {
            if (!path) return obj;
            const parts = path.split(/[\.\[\]]/).filter(p => p);
            let current = obj;
            for (const part of parts) {
                current = current[part];
            }
            return current;
        }

        // Ê†πÊçÆË∑ØÂæÑËÆæÁΩÆÂÄº
        function setValueByPath(obj, path, key, value) {
            if (!path) {
                obj[key] = value;
                return;
            }
            
            const parts = path.split(/[\.\[\]]/).filter(p => p);
            let current = obj;
            for (let i = 0; i < parts.length - 1; i++) {
                current = current[parts[i]];
            }
            
            const lastPart = parts[parts.length - 1];
            if (Array.isArray(current[lastPart])) {
                if (key === '') {
                    current[lastPart].push(value);
                } else {
                    current[lastPart][key] = value;
                }
            } else {
                current[lastPart][key] = value;
            }
        }

        // Ê†πÊçÆË∑ØÂæÑÂà†Èô§ÂÄº
        function deleteValueByPath(obj, path) {
            const parts = path.split(/[\.\[\]]/).filter(p => p);
            let current = obj;
            for (let i = 0; i < parts.length - 1; i++) {
                current = current[parts[i]];
            }
            
            const lastPart = parts[parts.length - 1];
            if (Array.isArray(current)) {
                current.splice(lastPart, 1);
            } else {
                delete current[lastPart];
            }
        }

        // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜËÉåÊôØÂÖ≥Èó≠
        document.getElementById('editModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Èù¢ÊùøÊäòÂè†ÂäüËÉΩ
        function togglePanel(panelType) {
            console.log('togglePanel called with:', panelType);
            const editorPanel = document.querySelector('.editor-panel');
            const viewerPanel = document.querySelector('.viewer-panel');
            const expandEditorBtn = document.getElementById('expandEditorBtn');
            const expandViewerBtn = document.getElementById('expandViewerBtn');
            const collapseEditorBtn = document.getElementById('collapseEditor');
            const collapseViewerBtn = document.getElementById('collapseViewer');
            const resetBtn = document.getElementById('resetPanelsBtn');

            if (panelType === 'editor') {
                // Â¶ÇÊûúÈ¢ÑËßàÂ∑≤ÁªèÊäòÂè†Ôºå‰∏çÂÖÅËÆ∏ÂÜçÊäòÂè†ÁºñËæëÂô®
                if (!editorPanel.classList.contains('panel-collapsed') && viewerPanel.classList.contains('panel-collapsed')) {
                    showNotification('‰∏çËÉΩÂêåÊó∂ÊäòÂè†‰∏§‰∏™Èù¢Êùø', 'warning');
                    return;
                }
                
                // ÂàáÊç¢ÁºñËæëÂô®Èù¢ÊùøÁöÑÊäòÂè†Áä∂ÊÄÅ
                editorPanel.classList.toggle('panel-collapsed');
                
                // Â¶ÇÊûúÁºñËæëÂô®Ë¢´ÊäòÂè†ÔºåÊòæÁ§∫Â±ïÂºÄÊåâÈíÆÂπ∂Êâ©Â±ïÈ¢ÑËßàÈù¢Êùø
                if (editorPanel.classList.contains('panel-collapsed')) {
                    expandEditorBtn.style.display = 'flex';
                    collapseEditorBtn.innerHTML = 'Â±ïÂºÄ ‚ñ∫';
                    collapseEditorBtn.title = 'Â±ïÂºÄÁºñËæëÂô®';
                    resetBtn.style.display = 'inline-block';
                    
                    // Êâ©Â±ïÈ¢ÑËßàÈù¢Êùø
                    viewerPanel.classList.add('panel-expanded');
                } else {
                    expandEditorBtn.style.display = 'none';
                    collapseEditorBtn.innerHTML = '‚óÑ ÊäòÂè†';
                    collapseEditorBtn.title = 'ÊäòÂè†ÁºñËæëÂô®';
                    
                    // ÊÅ¢Â§çÈ¢ÑËßàÈù¢Êùø
                    viewerPanel.classList.remove('panel-expanded');
                    
                    if (!viewerPanel.classList.contains('panel-collapsed')) {
                        resetBtn.style.display = 'none';
                    }
                }
            } else if (panelType === 'viewer') {
                // Â¶ÇÊûúÁºñËæëÂô®Â∑≤ÁªèÊäòÂè†Ôºå‰∏çÂÖÅËÆ∏ÂÜçÊäòÂè†È¢ÑËßà
                if (!viewerPanel.classList.contains('panel-collapsed') && editorPanel.classList.contains('panel-collapsed')) {
                    showNotification('‰∏çËÉΩÂêåÊó∂ÊäòÂè†‰∏§‰∏™Èù¢Êùø', 'warning');
                    return;
                }
                
                // ÂàáÊç¢È¢ÑËßàÈù¢ÊùøÁöÑÊäòÂè†Áä∂ÊÄÅ
                viewerPanel.classList.toggle('panel-collapsed');
                
                // Â¶ÇÊûúÈ¢ÑËßàË¢´ÊäòÂè†ÔºåÊòæÁ§∫Â±ïÂºÄÊåâÈíÆÂπ∂Êâ©Â±ïÁºñËæëÂô®Èù¢Êùø
                if (viewerPanel.classList.contains('panel-collapsed')) {
                    expandViewerBtn.style.display = 'flex';
                    collapseViewerBtn.innerHTML = '‚óÑ Â±ïÂºÄ';
                    collapseViewerBtn.title = 'Â±ïÂºÄÈ¢ÑËßà';
                    resetBtn.style.display = 'inline-block';
                    
                    // Êâ©Â±ïÁºñËæëÂô®Èù¢Êùø
                    editorPanel.classList.add('panel-expanded');
                } else {
                    expandViewerBtn.style.display = 'none';
                    collapseViewerBtn.innerHTML = 'ÊäòÂè† ‚ñ∫';
                    collapseViewerBtn.title = 'ÊäòÂè†È¢ÑËßà';
                    
                    // ÊÅ¢Â§çÁºñËæëÂô®Èù¢Êùø
                    editorPanel.classList.remove('panel-expanded');
                    
                    if (!editorPanel.classList.contains('panel-collapsed')) {
                        resetBtn.style.display = 'none';
                    }
                }
            }
            
            console.log('Panel states after toggle:', {
                editorCollapsed: editorPanel.classList.contains('panel-collapsed'),
                viewerCollapsed: viewerPanel.classList.contains('panel-collapsed'),
                editorExpanded: editorPanel.classList.contains('panel-expanded'),
                viewerExpanded: viewerPanel.classList.contains('panel-expanded'),
                expandEditorBtnDisplay: expandEditorBtn.style.display,
                expandViewerBtnDisplay: expandViewerBtn.style.display
            });
            
            // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
            updatePanelButtonStates();
        }

        function updateExpandButtonVisibility() {
            console.log('updateExpandButtonVisibility called');
            const editorPanel = document.querySelector('.editor-panel');
            const viewerPanel = document.querySelector('.viewer-panel');
            const expandEditorBtn = document.getElementById('expandEditorBtn');
            const expandViewerBtn = document.getElementById('expandViewerBtn');
            const resetBtn = document.getElementById('resetPanelsBtn');

            // Ê†πÊçÆÈù¢ÊùøÁä∂ÊÄÅÊòæÁ§∫/ÈöêËóèÂ±ïÂºÄÊåâÈíÆ
            expandEditorBtn.style.display = editorPanel.classList.contains('panel-collapsed') ? 'flex' : 'none';
            expandViewerBtn.style.display = viewerPanel.classList.contains('panel-collapsed') ? 'flex' : 'none';
            
            // Â¶ÇÊûú‰ªª‰∏ÄÈù¢ÊùøÊäòÂè†ÔºåÊòæÁ§∫ÊÅ¢Â§çÊåâÈíÆ
            resetBtn.style.display = (editorPanel.classList.contains('panel-collapsed') || 
                                     viewerPanel.classList.contains('panel-collapsed')) ? 
                                     'inline-block' : 'none';
                                     
            console.log('Button visibility updated:', {
                editorCollapsed: editorPanel.classList.contains('panel-collapsed'),
                viewerCollapsed: viewerPanel.classList.contains('panel-collapsed'),
                expandEditorBtnDisplay: expandEditorBtn.style.display,
                expandViewerBtnDisplay: expandViewerBtn.style.display,
                resetBtnDisplay: resetBtn.style.display
            });
        }

        // Êõ¥Êñ∞ÊäòÂè†/Â±ïÂºÄÊåâÈíÆÁöÑÁä∂ÊÄÅÂíåÊñáÊú¨
        function updatePanelButtonStates() {
            const editorPanel = document.querySelector('.editor-panel');
            const viewerPanel = document.querySelector('.viewer-panel');
            const expandEditorBtn = document.getElementById('expandEditorBtn');
            const expandViewerBtn = document.getElementById('expandViewerBtn');
            const resetBtn = document.getElementById('resetPanelsBtn');

            const editorCollapsed = editorPanel.classList.contains('panel-collapsed');
            const viewerCollapsed = viewerPanel.classList.contains('panel-collapsed');

            // ÊòæÁ§∫ÊàñÈöêËóèÊÅ¢Â§çÊåâÈíÆ
            resetBtn.style.display = editorCollapsed || viewerCollapsed ? 'inline-block' : 'none';

            // Êõ¥Êñ∞ÁºñËæëÂô®ÊåâÈíÆ
            if (editorCollapsed) {
                expandEditorBtn.disabled = viewerCollapsed; // Â¶ÇÊûúÂè¶‰∏Ä‰∏™Â∑≤ÊäòÂè†ÔºåÂàôÁ¶ÅÁî®Ê≠§ÊåâÈíÆ
                expandEditorBtn.title = viewerCollapsed ? '‰∏çËÉΩÂêåÊó∂ÊäòÂè†‰∏§‰∏™Èù¢Êùø' : 'ÊäòÂè†ÁºñËæëÂô®';
                expandEditorBtn.innerHTML = 'Â±ïÂºÄ ‚ñ∫';
            } else {
                expandEditorBtn.disabled = viewerCollapsed; // Â¶ÇÊûúÂè¶‰∏Ä‰∏™Â∑≤ÊäòÂè†ÔºåÂàôÁ¶ÅÁî®Ê≠§ÊåâÈíÆ
                expandEditorBtn.title = viewerCollapsed ? '‰∏çËÉΩÂêåÊó∂ÊäòÂè†‰∏§‰∏™Èù¢Êùø' : 'ÊäòÂè†ÁºñËæëÂô®';
                expandEditorBtn.innerHTML = '‚óÑ ÊäòÂè†';
            }

            // Êõ¥Êñ∞È¢ÑËßàÂô®ÊåâÈíÆ
            if (viewerCollapsed) {
                expandViewerBtn.classList.add('expand');
                expandViewerBtn.title = 'Â±ïÂºÄÈ¢ÑËßà';
                expandViewerBtn.innerHTML = '‚óÑ Â±ïÂºÄ';
            } else {
                expandViewerBtn.disabled = editorCollapsed; // Â¶ÇÊûúÂè¶‰∏Ä‰∏™Â∑≤ÊäòÂè†ÔºåÂàôÁ¶ÅÁî®Ê≠§ÊåâÈíÆ
                expandViewerBtn.title = editorCollapsed ? '‰∏çËÉΩÂêåÊó∂ÊäòÂè†‰∏§‰∏™Èù¢Êùø' : 'ÊäòÂè†È¢ÑËßà';
                expandViewerBtn.innerHTML = 'ÊäòÂè† ‚ñ∫';
            }
        }

        // ÈáçÁΩÆÈù¢ÊùøÂ∏ÉÂ±Ä
        function resetPanels() {
            const editorPanel = document.querySelector('.editor-panel');
            const viewerPanel = document.querySelector('.viewer-panel');
            const expandEditorBtn = document.getElementById('expandEditorBtn');
            const expandViewerBtn = document.getElementById('expandViewerBtn');
            const collapseEditorBtn = document.getElementById('collapseEditor');
            const collapseViewerBtn = document.getElementById('collapseViewer');
            const resetBtn = document.getElementById('resetPanelsBtn');

            // ÁßªÈô§ÊâÄÊúâÊäòÂè†ÂíåÂ±ïÂºÄÁ±ª
            editorPanel.classList.remove('panel-collapsed', 'panel-expanded');
            viewerPanel.classList.remove('panel-collapsed', 'panel-expanded');

            // ÈöêËóèÂ±ïÂºÄÊåâÈíÆ
            expandEditorBtn.style.display = 'none';
            expandViewerBtn.style.display = 'none';

            // ÈáçÁΩÆÊåâÈíÆÁä∂ÊÄÅ
            collapseEditorBtn.innerHTML = '‚óÑ ÊäòÂè†';
            collapseEditorBtn.classList.remove('expand');
            collapseEditorBtn.title = 'ÊäòÂè†ÁºñËæëÂô®';
            collapseEditorBtn.disabled = false;

            collapseViewerBtn.innerHTML = 'ÊäòÂè† ‚ñ∫';
            collapseViewerBtn.classList.remove('expand');
            collapseViewerBtn.title = 'ÊäòÂè†È¢ÑËßà';
            collapseViewerBtn.disabled = false;

            // ÈöêËóèÊÅ¢Â§çÊåâÈíÆ
            resetBtn.style.display = 'none';

            // ÊòæÁ§∫ÈÄöÁü•
            showNotification('Èù¢ÊùøÂ∏ÉÂ±ÄÂ∑≤ÈáçÁΩÆ', 'success');
        }

        // ÊòæÁ§∫ÈÄöÁü•Ê∂àÊÅØ
        function showNotification(message, type = 'info') {
            // ÂàõÂª∫ÈÄöÁü•ÂÖÉÁ¥†
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <span style="margin-right: 10px;">${type === 'warning' ? '‚ö†Ô∏è' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è'}</span>
                ${message}
            `;
            
            // ËÆæÁΩÆÊ†∑Âºè
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: ${type === 'warning' ? '#fff3cd' : type === 'error' ? '#f8d7da' : '#d1ecf1'};
                color: ${type === 'warning' ? '#856404' : type === 'error' ? '#721c24' : '#0c5460'};
                border: 1px solid ${type === 'warning' ? '#ffeaa7' : type === 'error' ? '#f5c6cb' : '#bee5eb'};
                padding: 12px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                z-index: 10000;
                animation: slideInNotification 0.3s ease;
                max-width: 320px;
                font-size: 14px;
                line-height: 1.4;
            `;
            
            document.body.appendChild(notification);
            
            // 3ÁßíÂêéËá™Âä®ÁßªÈô§
            setTimeout(() => {
                notification.style.animation = 'slideOutNotification 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>

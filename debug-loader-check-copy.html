<!DOCTYPE html>
<html>
<head>
    <title>模块加载检查 - esptool-js 复制版本</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .status { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>模块加载检查</h1>
    
    <div id="results"></div>

    <!-- 加载依赖 -->
    <script src="web_serial/downloaders/base-downloader.js"></script>
    <script src="web_serial/esp-protocol-reuse.js"></script>
    <script src="web_serial/downloaders/esp32-simple-downloader.js"></script>

    <script>
        function checkModule(name, obj) {
            const resultsDiv = document.getElementById('results');
            const statusDiv = document.createElement('div');
            
            if (obj !== undefined) {
                statusDiv.className = 'status success';
                statusDiv.innerHTML = `✅ <strong>${name}</strong>: 已加载 (${typeof obj})`;
                if (typeof obj === 'object' && obj !== null) {
                    statusDiv.innerHTML += ` - 属性: ${Object.keys(obj).length}个`;
                }
            } else {
                statusDiv.className = 'status error';
                statusDiv.innerHTML = `❌ <strong>${name}</strong>: 未定义`;
            }
            
            resultsDiv.appendChild(statusDiv);
        }

        window.onload = function() {
            console.log('开始检查模块加载状态...');
            
            // 检查各个模块
            checkModule('BaseDownloader', window.BaseDownloader);
            checkModule('ESPProtocolReuse', window.ESPProtocolReuse);
            checkModule('ESP32SimpleDownloader', window.ESP32SimpleDownloader);
            
            // 测试能否实例化
            try {
                if (window.ESP32SimpleDownloader && window.BaseDownloader) {
                    const resultsDiv = document.getElementById('results');
                    const testDiv = document.createElement('div');
                    testDiv.className = 'status info';
                    testDiv.innerHTML = '💡 <strong>实例化测试</strong>: ESP32SimpleDownloader 类可以访问';
                    resultsDiv.appendChild(testDiv);
                }
            } catch (error) {
                const resultsDiv = document.getElementById('results');
                const errorDiv = document.createElement('div');
                errorDiv.className = 'status error';
                errorDiv.innerHTML = `❌ <strong>实例化测试失败</strong>: ${error.message}`;
                resultsDiv.appendChild(errorDiv);
            }
            
            console.log('模块检查完成');
        };
    </script>
</body>
</html> 